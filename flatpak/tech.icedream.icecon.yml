app-id: tech.icedream.icecon

runtime: org.freedesktop.Platform
runtime-version: '20.08'

sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang

command: icecon

finish-args:
  - --share=ipc # Share IPC namespace with the host (necessary for X11).
  - --socket=x11
  - --share=network

build-options:
  build-args:
    - --share=network
  env:
    - GOBIN=/app/bin
    - GOROOT=/usr/lib/sdk/golang

modules:
  - name: icecon
    buildsystem: simple
    build-commands:
      - $GOROOT/bin/go mod download
      - $GOROOT/bin/go generate -v ./...
      - $GOROOT/bin/go build -v -ldflags '-s -w' -o icecon
      - install -Dm00755 icecon $FLATPAK_DEST/bin/icecon
    sources:
      - type: dir
        path: ../
